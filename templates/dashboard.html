<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../static/css/dashboard.css" />
    <link rel="stylesheet" href="chart-styles.css" />
    <title>Temp Dashboard</title>
    <style>
      /* Add your custom CSS here */

      /* Add your custom CSS here */
      body.dark {
        background-color: #121212;
        color: #e0e0e0;
      }

      body.dark .sidebar,
      body.dark .content nav,
      body.dark .content main {
        background-color: #333;
        color: #e0e0e0;
      }

      body.dark .sidebar .side-menu li a {
        color: #e0e0e0;
      }

      body.dark .sidebar .side-menu li.active a {
        background-color: #444;
      }

      body.dark .sidebar .side-menu li a:hover {
        background-color: #444;
      }

      body.dark .content-section h2 {
        color: #e0e0e0;
      }

      .device-counter {
        display: flex;
        align-items: center;
        margin-top: 20px;
      }

      .device-counter button {
        width: 30px;
        height: 30px;
        font-size: 20px;
        text-align: center;
        line-height: 30px;
        border: 1px solid #ddd;
        background-color: #f2f2f2;
        cursor: pointer;
      }

      .device-counter span {
        width: 30px;
        text-align: center;
        margin: 0 10px;
        font-size: 20px;
      }

      #device-list {
        margin-top: 20px;
      }

      .content-section {
        display: none;
      }

      .table-container {
        margin-top: 20px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }

      th {
        background-color: #f2f2f2;
      }

      .device-item {
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        margin-bottom: 10px;
        background-color: #fff;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .device-item p {
        margin: 5px 0;
      }

      .notif-content {
        display: none;
        background-color: #fff;
        border: 1px solid #ddd;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 10px;
        max-width: 300px;
        position: absolute;
        right: 20px;
        top: 50px;
        z-index: 1000;
        border-radius: 8px;
      }

      .notif-content ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .notif-content ul li {
        border-bottom: 1px solid #ddd;
        padding: 10px;
        transition: background-color 0.3s;
      }

      .notif-content ul li:hover {
        background-color: #f9f9f9;
      }

      .notif-content ul li:last-child {
        border-bottom: none;
      }

      .notif {
        position: relative;
        cursor: pointer;
      }

      .notif .count {
        background-color: red;
        color: white;
        font-size: 12px;
        border-radius: 50%;
        padding: 2px 6px;
        position: absolute;
        top: -5px;
        right: -5px;
      }
      .status-message {
        color: red;
        font-size: 1em;
        margin-top: 5px;
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <a href="#" class="logo">
        <i class="bx bx-code-alt"></i>
        <div class="logo-name"><span>TIB</span></div>
      </a>
      <ul class="side-menu">
        <li>
          <a href="#" id="dashboard-link"
            ><i class="bx bxs-dashboard"></i>Dashboard</a
          >
        </li>

        <li>
          <a href="#" id="request-device-link"
            ><i class="bx bx-devices"></i>Request Device Data</a
          >
        </li>
        <ul>
          <li class="add-device-link">
            <a href="#" id="add-device-link">
              <i class="bx bx-devices"></i>Add Device
            </a>
          </li>
          <li class="get-device-link">
            <a href="#" id="get-device-link">
              <i class="bx bx-devices"></i>Get Device Data
            </a>
          </li>
        </ul>
      </ul>
      <ul class="side-menu">
        <li>
          <a href="#" id="logout-link" class="logout"
            ><i class="bx bx-log-out-circle"></i>Logout</a
          >
        </li>
      </ul>
    </div>
    <div class="content">
      <nav>
        <i class="bx bx-menu"></i>
        <form action="#">
          <div class="form-input">
            <input type="search" placeholder="Search..." />
            <button class="search-btn" type="submit">
              <i class="bx bx-search"></i>
            </button>
          </div>
        </form>
        <input type="checkbox" id="theme-toggle" hidden />
        <label for="theme-toggle" class="theme-toggle"></label>
        <a href="#" class="notif">
          <i class="bx bx-bell"></i><span class="count">1</span>
          <div class="notif-content">
            <ul id="notification-list"></ul>
          </div>
        </a>
        <a href="#" id="loadProfile">
          <img
            src="https://img.icons8.com/?size=100&id=rrtYnzKMTlUr&format=png&color=000000"
            alt="Profile"
            class="profile-img"
          />
        </a>
      </nav>
      <main>
        <div class="header" id="clickable-div">
          <div class="left">
            <ul class="breadcrumb"></ul>
          </div>
        </div>
        <div id="flash-messages">
          {% with messages = get_flashed_messages() %} {% if messages %}
          <ul class="flashes">
            {% for message in messages %}
            <li>{{ message }}</li>
            {% endfor %}
          </ul>
          {% endif %} {% endwith %}
        </div>
        <div id="dashboard-content" class="content-section">
          <h2>Dashboard Content</h2>
          <p>
            Welcome to the dashboard! Here you can see an overview of your
            activity.
          </p>
        </div>
        <div id="analytics-content" class="content-section">
          <h2>Analytics Content</h2>
          <select id="deviceSelect" onchange="fetchDeviceData()">
            <option value="">Select Device</option>
            {% for device in devices %}
            <option value="{{ device }}">{{ device }}</option>
            {% endfor %}
          </select>

          <div class="chart-container">
            <h1 class="chart-title">Voltage</h1>
            <canvas id="voltageChart"></canvas>
            <div id="voltageTable" class="table-container"></div>
          </div>
          <div class="chart-container">
            <h1 class="chart-title">Current</h1>
            <canvas id="currentChart"></canvas>
            <div id="currentTable" class="table-container"></div>
          </div>
          <div class="chart-container">
            <h1 class="chart-title">Power</h1>
            <canvas id="powerChart"></canvas>
            <div id="powerTable" class="table-container"></div>
          </div>
          <div class="chart-container">
            <h1 class="chart-title">Brightness Level</h1>
            <canvas id="brightnessChart"></canvas>
            <div id="brightnessTable" class="table-container"></div>
          </div>
          <div class="chart-container">
            <h1 class="chart-title">Battery Temperature</h1>
            <canvas id="batteryChart"></canvas>
            <div id="batteryTable" class="table-container"></div>
          </div>
        </div>

        <div id="device-content" class="content-section">
          <h2>Request Device Data</h2>
          <form
            id="device-form1"
            method="POST"
            action="/dashboard/request_device"
          >
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <div class="device-counter">
              <button
                id="decrease-device"
                type="button"
                onclick="changeDeviceCount(-1)"
              >
                -
              </button>
              <span id="device-count">0</span>
              <button
                id="increase-device"
                type="button"
                onclick="changeDeviceCount(1)"
              >
                +
              </button>
            </div>
            <input
              type="hidden"
              id="device_count"
              name="device_count"
              value="0"
            />
            <button id="request-device" type="submit">Request</button>
          </form>

          <div id="pending-request" style="display: none">
            <p>Pending Request: Please wait for admin to approve.</p>
          </div>
        </div>

        <div id="add-device" class="content-section hidden">
          <h2>Add Devices</h2>
          <div id="request-device-message" class="status-message hidden">
            You need to request devices to access this section.
          </div>
          <form
            id="device-form"
            method="POST"
            action="/dashboard/add_device"
            class="hidden"
          >
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <label for="entityName">Entity Name</label>
            <input type="text" id="entityName" name="entityName" required />
            <label for="deviceIMEI">Device IMEI</label>
            <input type="text" id="deviceIMEI" name="deviceIMEI" required />
            <label for="simICCId">SIM ICC ID</label>
            <input type="text" id="simICCId" name="simICCId" required />
            <label for="batterySLNo">Battery SL No</label>
            <input type="text" id="batterySLNo" name="batterySLNo" required />
            <label for="panelSLNo">Panel SL No</label>
            <input type="text" id="panelSLNo" name="panelSLNo" required />
            <label for="luminarySLNo">Luminary SL No</label>
            <input type="text" id="luminarySLNo" name="luminarySLNo" required />
            <label for="mobileNo">Mobile No</label>
            <input type="text" id="mobileNo" name="mobileNo" required />
            <label for="district">District</label>
            <input type="text" id="district" name="district" required />
            <label for="panchayat">Panchayat</label>
            <input type="text" id="panchayat" name="panchayat" required />
            <label for="block">Block</label>
            <input type="text" id="block" name="block" required />
            <label for="wardNo">Ward No</label>
            <input type="text" id="wardNo" name="wardNo" required />
            <label for="poleNo">Pole No</label>
            <input type="text" id="poleNo" name="poleNo" required />
            <label for="active">Active</label>
            <select id="active" name="active" required>
              <option value="true">True</option>
              <option value="false">False</option>
            </select>
            <label for="installationDate">Installation Date</label>
            <input
              type="date"
              id="installationDate"
              name="installationDate"
              required
            />
            <button type="submit">Submit</button>
            <div
              id="loading-overlay"
              class="loading-overlay"
              style="display: none"
            >
              <div class="spinner"></div>
            </div>
          </form>
        </div>
        <div id="view-device-content" class="content-section hidden">
          <h2>View Devices Content</h2>
          <div id="add-device-message" class="status-message hidden">
            You need to add a device to access this section.
          </div>
          <div id="device-list1">
            <!-- Device data will be injected here -->
          </div>
        </div>
      </main>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@latest"></script>
    <script>
      function changeDeviceCount(delta) {
        const deviceCountElement = document.getElementById("device-count");
        let deviceCount = parseInt(deviceCountElement.textContent, 10);
        deviceCount += delta;

        if (deviceCount < 0) deviceCount = 0;
        if (deviceCount === 0) {
          displayFlashMessage("Kindly Select at least 1 device");
        }
        deviceCountElement.textContent = deviceCount;
        document.getElementById("device_count").value = deviceCount;
      }
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const toggler = document.getElementById("theme-toggle");
        const sideLinks = document.querySelectorAll(
          ".sidebar .side-menu li a:not(.logout)"
        );
        const menuBar = document.querySelector(".content nav .bx.bx-menu");
        const sideBar = document.querySelector(".sidebar");
        const searchBtn = document.querySelector(
          ".content nav form .form-input button"
        );
        const searchBtnIcon = document.querySelector(
          ".content nav form .form-input button .bx"
        );
        const searchForm = document.querySelector(".content nav form");
        const loadingOverlay = document.getElementById("loading-overlay");

        toggler.addEventListener("change", function () {
          if (this.checked) {
            document.body.classList.add("dark");
          } else {
            document.body.classList.remove("dark");
          }
        });

        sideLinks.forEach((item) => {
          const li = item.parentElement;
          item.addEventListener("click", () => {
            sideLinks.forEach((i) => {
              i.parentElement.classList.remove("active");
            });
            li.classList.add("active");
          });
        });

        menuBar.addEventListener("click", () => {
          sideBar.classList.toggle("close");
        });

        searchBtn.addEventListener("click", function (e) {
          if (window.innerWidth < 576) {
            e.preventDefault();
            searchForm.classList.toggle("show");
            if (searchForm.classList.contains("show")) {
              searchBtnIcon.classList.replace("bx-search", "bx-x");
            } else {
              searchBtnIcon.classList.replace("bx-x", "bx-search");
            }
          }
        });

        window.addEventListener("resize", () => {
          if (window.innerWidth < 768) {
            sideBar.classList.add("close");
          } else {
            sideBar.classList.remove("close");
          }
          if (window.innerWidth > 576) {
            searchBtnIcon.classList.replace("bx-x", "bx-search");
            searchForm.classList.remove("show");
          }
        });

        loadLastActiveSection();
        data = [];

        processChartData(data);

        function processChartData(data) {
          const labels = [];
          const voltageData = [];
          const currentData = [];
          const powerData = [];
          const brightnessData = [];
          const batteryData = [];

          data.forEach((record) => {
            labels.push(record.date);
            voltageData.push(record.PV);
            currentData.push(record.PC);
            powerData.push(record.PP);
            brightnessData.push(record.BrL);
            batteryData.push(record.BTem);
          });

          createChart(
            "voltageChart",
            "Voltage",
            labels,
            voltageData,
            "Voltage (V)",
            "voltageTable"
          );
          createChart(
            "currentChart",
            "Current",
            labels,
            currentData,
            "Current (A)",
            "currentTable"
          );
          createChart(
            "powerChart",
            "Power",
            labels,
            powerData,
            "Power (W)",
            "powerTable"
          );
          createChart(
            "brightnessChart",
            "Brightness Level",
            labels,
            brightnessData,
            "Brightness (%)",
            "brightnessTable"
          );
          createChart(
            "batteryChart",
            "Battery Temperature",
            labels,
            batteryData,
            "Temperature (°C)",
            "batteryTable"
          );
        }

        function createChart(
          chartId,
          title,
          labels,
          data,
          yAxisLabel,
          tableId
        ) {
          const ctx = document.getElementById(chartId).getContext("2d");

          new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: title,
                  data: data,
                  borderColor: "rgba(75, 192, 192, 1)",
                  backgroundColor: "rgba(75, 192, 192, 0.2)",
                  fill: true,
                },
              ],
            },
            options: {
              responsive: true,
              scales: {
                x: {
                  type: "time",
                  time: {
                    unit: "day",
                    tooltipFormat: "MMM dd yyyy",
                  },
                },
                y: {
                  title: {
                    display: true,
                    text: yAxisLabel,
                  },
                },
              },
            },
          });

          generateTable(tableId, labels, data);
        }

        function generateTable(tableId, labels, data) {
          const tableContainer = document.getElementById(tableId);
          const table = document.createElement("table");
          const thead = document.createElement("thead");
          const tbody = document.createElement("tbody");

          const headerRow = document.createElement("tr");
          const dateHeader = document.createElement("th");
          dateHeader.textContent = "Date";
          const valueHeader = document.createElement("th");
          valueHeader.textContent = "Value";

          headerRow.appendChild(dateHeader);
          headerRow.appendChild(valueHeader);
          thead.appendChild(headerRow);

          labels.forEach((label, index) => {
            const row = document.createElement("tr");
            const dateCell = document.createElement("td");
            dateCell.textContent = label;
            const valueCell = document.createElement("td");
            valueCell.textContent = data[index];

            row.appendChild(dateCell);
            row.appendChild(valueCell);
            tbody.appendChild(row);
          });

          table.appendChild(thead);
          table.appendChild(tbody);
          tableContainer.innerHTML = "";
          tableContainer.appendChild(table);
        }

        const notifIcon = document.querySelector(".notif");
        const notifContent = document.querySelector(".notif-content");
        const notificationList = document.getElementById("notification-list");

        notifIcon.addEventListener("click", function () {
          notifContent.style.display =
            notifContent.style.display === "none" ? "block" : "none";
        });

        document.addEventListener("click", function (event) {
          if (!notifIcon.contains(event.target)) {
            notifContent.style.display = "none";
          }
        });

        document
          .getElementById("dashboard-link")
          .addEventListener("click", function () {
            showSection("dashboard-content");
          });

        /*    document
          .getElementById("analytics-link")
          .addEventListener("click", function () {
            showSection("analytics-content");
          });*/

        document
          .getElementById("request-device-link")
          .addEventListener("click", function () {
            showSection("device-content");
          });

        document
          .getElementById("add-device-link")
          .addEventListener("click", function () {
            showSection("add-device");
          });

        document
          .getElementById("get-device-link")
          .addEventListener("click", function () {
            showSection("view-device-content");
            fetchDevices();
          });

        document
          .getElementById("loadProfile")
          .addEventListener("click", function (event) {
            event.preventDefault();
            window.location.href = "/profile-content";
          });

        document
          .getElementById("logout-link")
          .addEventListener("click", function (e) {
            e.preventDefault();
            window.location.href = "/logout";
          });

        document
          .getElementById("device-form")
          .addEventListener("submit", function (event) {
            event.preventDefault();

            const loadingOverlay = document.getElementById("loading-overlay");
            loadingOverlay.style.display = "flex";

            const formData = new FormData(event.target);
            const csrfToken = formData.get("csrf_token");
            const data = Object.fromEntries(formData.entries());

            axios
              .post("/dashboard/add_device", data, {
                headers: {
                  "X-CSRFToken": csrfToken,
                },
              })
              .then((response) => {
                loadingOverlay.style.display = "none";
                displayFlashMessage("Device Added Successfully");
                location.reload();
              })
              .catch((error) => {
                loadingOverlay.style.display = "none";
                console.error("There was an error adding the device:", error);
                displayFlashMessage("Error adding device. Please try again.");
              });
          });

        loadLastActiveSection();

        document
          .getElementById("get-device-link")
          .addEventListener("click", function () {
            showSection("view-device-content");
            // Call fetchDevices function when the link is clicked
          });

        function showSection(sectionId) {
          // Hide all sections
          document.querySelectorAll(".content-section").forEach((section) => {
            section.style.display = "none";
          });
          // Show the selected section
          document.getElementById(sectionId).style.display = "block";
        }

        // Load last active section

        // Fetch devices
        fetchDevices();

        function showSection(sectionId) {
          const sections = document.querySelectorAll(".content-section");
          sections.forEach((section) => {
            section.style.display = section.id === sectionId ? "block" : "none";
          });
          saveCurrentSection(sectionId);
          updateSidebarActiveState(sectionId);
        }
        function fetchDevices() {
          axios
            .get("/dashboard/view_devices")
            .then((response) => {
              const devices = response.data;
              const deviceList = document.getElementById("device-list1");
              deviceList.innerHTML = "";

              if (devices.error) {
                deviceList.innerHTML = `<p>${devices.error}</p>`;
              } else {
                devices.forEach((device) => {
                  const deviceItem = document.createElement("div");
                  deviceItem.className = "device";
                  deviceItem.innerHTML = `
                  <p>Entity Name: ${device.entityName}</p>
                  <p>Device IMEI: ${device.deviceIMEI}</p>
                  <p>SIM ICC ID: ${device.simICCId}</p>
                  <p>Battery SL No: ${device.batterySLNo}</p>
                  <p>Panel SL No: ${device.panelSLNo}</p>
                  <p>Luminary SL No: ${device.luminarySLNo}</p>
                  <p>Mobile No: ${device.mobileNo}</p>
                  <p>District: ${device.district}</p>
                  <p>Panchayat: ${device.panchayat}</p>
                  <p>Block: ${device.block}</p>
                  <p>Ward No: ${device.wardNo}</p>
                  <p>Pole No: ${device.poleNo}</p>
                  <p>Active: ${device.active}</p>
                  <p>Installation Date: ${device.installationDate}</p>
                `;
                  deviceList.appendChild(deviceItem);
                });
              }
            })
            .catch((error) => {
              console.error("Error fetching devices:", error);
              const deviceList = document.getElementById("device-list1");
              deviceList.innerHTML =
                "<p>Error fetching devices. Please try again later.</p>";
              if (error.response) {
                console.error("Response data:", error.response.data);
                console.error("Response status:", error.response.status);
                console.error("Response headers:", error.response.headers);
              } else if (error.request) {
                console.error("Request data:", error.request);
              } else {
                console.error("Error message:", error.message);
              }
              console.error("Config:", error.config);
            });
        }

        // Fetch devices when the page loads

        //request device access

        window.onload = function () {
          let registeredDevicesCount = 0;

          // Fetch the registered device count
          axios
            .get("/dashboard/get_device_count")
            .then((response) => {
              if (response.data.registered_devices_count !== undefined) {
                registeredDevicesCount = response.data.registered_devices_count;
              } else {
                console.error("Error fetching registered device count.");
              }
            })
            .catch((error) => {
              console.error("Error fetching registered device count.", error);
            });

          // Check the device request status
          axios
            .get("/dashboard/get_request_status")
            .then((response) => {
              if (response.data.status === "pending") {
                document.getElementById("device-form1").style.display = "none";
                document.getElementById("pending-request").style.display =
                  "block";
              } else {
                document.getElementById("device-form1").style.display = "block";
                document.getElementById("pending-request").style.display =
                  "none";
              }
            })
            .catch((error) => {
              console.error("Error fetching device request status.", error);
            });

          document
            .getElementById("device-form1")
            .addEventListener("submit", function (event) {
              event.preventDefault();

              const formData = new FormData(event.target);
              const csrfToken = formData.get("csrf_token");
              const deviceCount = parseInt(formData.get("device_count"), 10);

              if (deviceCount === 0) {
                displayFlashMessage("Kindly Select at least 1 device");
                return;
              }

              const data = Object.fromEntries(formData.entries());

              axios
                .post("/dashboard/request_device", data, {
                  headers: {
                    "X-CSRFToken": csrfToken,
                  },
                })
                .then((response) => {
                  if (response.data.redirect) {
                    window.location.href = response.data.redirect;
                  } else {
                    // Hide the form and show pending request message
                    document.getElementById("device-form1").style.display =
                      "none";
                    document.getElementById("pending-request").style.display =
                      "block";
                  }
                })
                .catch((error) => {
                  if (error.response && error.response.data) {
                    displayFlashMessage(
                      error.response.data.message,
                      error.response.data.category
                    );
                  } else {
                    displayFlashMessage(
                      "Error submitting device request. Please try again.",
                      "error"
                    );
                  }
                });
            });
        };

        function displayFlashMessage(message, category) {
          const flashMessagesElement =
            document.getElementById("flash-messages");
          const ulElement = document.createElement("ul");
          ulElement.className = "flashes";
          const liElement = document.createElement("li");
          liElement.className = category;
          liElement.textContent = message;
          ulElement.appendChild(liElement);

          flashMessagesElement.innerHTML = ""; // Clear previous messages
          flashMessagesElement.appendChild(ulElement);

          // Remove the flash message after 2 seconds and reload the content section
          setTimeout(() => {
            flashMessagesElement.innerHTML = "";
            // Clear the flash message
            // Reload the content section
          }, 2000);
        }

        function saveCurrentSection(sectionId) {
          sessionStorage.setItem("currentDashboardSection", sectionId);
        }

        function loadLastActiveSection() {
          const lastSection = sessionStorage.getItem("currentDashboardSection");
          if (lastSection) {
            showSection(lastSection);
          } else {
            showSection("dashboard-content");
          }
        }

        function updateSidebarActiveState(sectionId) {
          const sideLinks = document.querySelectorAll(
            ".sidebar .side-menu li a:not(.logout)"
          );
          sideLinks.forEach((item) => {
            const li = item.parentElement;
            if (item.id === `${sectionId.replace("-content", "")}-link`) {
              li.classList.add("active");
            } else {
              li.classList.remove("active");
            }
          });
        }
      });
      document.addEventListener("DOMContentLoaded", function () {
        // Function to show or hide messages and forms based on approval status
        function updateMenuVisibility() {
          axios
            .get("/dashboard/get_request_status")
            .then((response) => {
              const requestDeviceMessage = document.getElementById(
                "request-device-message"
              );
              const deviceForm = document.getElementById("device-form");

              if (response.data.status === "approved") {
                requestDeviceMessage.classList.add("hidden");
                deviceForm.classList.remove("hidden");
              } else {
                requestDeviceMessage.classList.remove("hidden");
                deviceForm.classList.add("hidden");
              }

              axios
                .get("/dashboard/check_device_added")
                .then((response) => {
                  const addDeviceMessage =
                    document.getElementById("add-device-message");

                  if (response.data.device_added) {
                    addDeviceMessage.classList.add("hidden");
                  } else {
                    addDeviceMessage.classList.remove("hidden");
                  }
                })
                .catch((error) => {
                  console.error("Error checking if device is added:", error);
                });
            })
            .catch((error) => {
              console.error("Error getting request status:", error);
            });
        }

        // Check the user's status on page load
        updateMenuVisibility();

        // Event listener for the "Add Device" link
        document
          .getElementById("add-device-link")
          .addEventListener("click", function (event) {
            const requestDeviceMessage = document.getElementById(
              "request-device-message"
            );
            if (requestDeviceMessage.classList.contains("hidden")) {
              showSection("add-device");
            } else {
              alert("You need to request devices to access this section.");
            }
            event.preventDefault();
          });

        // Event listener for the "Get Device Data" link
        document
          .getElementById("get-device-link")
          .addEventListener("click", function (event) {
            const addDeviceMessage =
              document.getElementById("add-device-message");
            if (addDeviceMessage.classList.contains("hidden")) {
              showSection("view-device-content");
              fetchDevices();
            } else {
              alert("You need to add a device to access this section.");
            }
            event.preventDefault();
          });

        // Existing event listeners and other JavaScript logic...
      });

      function showSection(sectionId) {
        // Hide all content sections
        const sections = document.querySelectorAll(".content-section");
        sections.forEach((section) => {
          section.classList.add("hidden");
        });

        // Show the selected section
        const section = document.getElementById(sectionId);
        section.classList.remove("hidden");
      }
    </script>
    <div id="loading-overlay" style="display: none">
      <div class="spinner"></div>
    </div>
  </body>
</html>
