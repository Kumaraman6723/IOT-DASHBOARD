<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../static/css/dashboard.css" />
    <link rel="stylesheet" href="chart-styles.css" />
    <title>Temp Dashboard</title>
    <style>
      .device-counter {
        display: flex;
        align-items: center;
        margin-top: 20px;
      }

      .device-counter button {
        width: 30px;
        height: 30px;
        font-size: 20px;
        text-align: center;
        line-height: 30px;
        border: 1px solid #ddd;
        background-color: #f2f2f2;
        cursor: pointer;
      }

      .device-counter span {
        width: 30px;
        text-align: center;
        margin: 0 10px;
        font-size: 20px;
      }

      #device-list {
        margin-top: 20px;
      }

      .content-section {
        display: none;
      }
      .table-container {
        margin-top: 20px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
      }
      th {
        background-color: #f2f2f2;
      }
      .notif-content {
        display: none;
        background-color: #fff;
        border: 1px solid #ddd;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 10px;
        max-width: 300px;
        position: absolute;
        right: 20px;
        top: 50px;
        z-index: 1000;
        border-radius: 8px;
      }

      .notif-content ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .notif-content ul li {
        border-bottom: 1px solid #ddd;
        padding: 10px;
        transition: background-color 0.3s;
      }

      .notif-content ul li:hover {
        background-color: #f9f9f9;
      }

      .notif-content ul li:last-child {
        border-bottom: none;
      }

      .notif {
        position: relative;
        cursor: pointer;
      }

      .notif .count {
        background-color: red;
        color: white;
        font-size: 12px;
        border-radius: 50%;
        padding: 2px 6px;
        position: absolute;
        top: -5px;
        right: -5px;
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <a href="#" class="logo">
        <i class="bx bx-code-alt"></i>
        <div class="logo-name"><span>temp</span></div>
      </a>
      <ul class="side-menu">
        <li>
          <a href="#" id="dashboard-link"
            ><i class="bx bxs-dashboard"></i>Dashboard</a
          >
        </li>
        <li class="active">
          <a href="#" id="analytics-link"
            ><i class="bx bx-analyse"></i>Analytics</a
          >
        </li>
        <li>
          <a href="#" id="Request-device-link"
            ><i class="bx bx-devices"></i>Request Device Data</a
          >
        </li>
      </ul>
      <ul class="side-menu">
        <li>
          <a href="#" onclick="signOut()" class="logout"
            ><i class="bx bx-log-out-circle"></i>Logout</a
          >
        </li>
      </ul>
    </div>
    <div class="content">
      <nav>
        <i class="bx bx-menu"></i>
        <form action="#">
          <div class="form-input">
            <input type="search" placeholder="Search..." />
            <button class="search-btn" type="submit">
              <i class="bx bx-search"></i>
            </button>
          </div>
        </form>
        <input type="checkbox" id="theme-toggle" hidden />
        <label for="theme-toggle" class="theme-toggle"></label>
        <a href="#" class="notif">
          <i class="bx bx-bell"></i><span class="count">1</span>
          <div class="notif-content">
            <ul id="notification-list"></ul>
          </div>
        </a>
        <a href="profile.html" class="profile">
          <img
            src="https://img.icons8.com/?size=100&id=rrtYnzKMTlUr&format=png&color=000000"
            alt="Profile"
          />
        </a>
      </nav>
      <main>
        <div class="header" id="clickable-div">
          <div class="left">
            <h1>Dashboard</h1>
            <ul class="breadcrumb"></ul>
          </div>
        </div>
        <div id="dashboard-content" class="content-section">
          <h2>Dashboard Content</h2>
          <p>
            Welcome to the dashboard! Here you can see an overview of your
            activity.
          </p>
        </div>
        <div id="analytics-content" class="content-section">
          <h2>Analytics Content</h2>
          <div class="chart-container">
            <h1 class="chart-title">Voltage</h1>
            <canvas id="voltageChart"></canvas>
            <div id="voltageTable" class="table-container"></div>
          </div>
          <div class="chart-container">
            <h1 class="chart-title">Current</h1>
            <canvas id="currentChart"></canvas>
            <div id="currentTable" class="table-container"></div>
          </div>
          <div class="chart-container">
            <h1 class="chart-title">Power</h1>
            <canvas id="powerChart"></canvas>
            <div id="powerTable" class="table-container"></div>
          </div>
          <div class="chart-container">
            <h1 class="chart-title">Brightness Level</h1>
            <canvas id="brightnessChart"></canvas>
            <div id="brightnessTable" class="table-container"></div>
          </div>
          <div class="chart-container">
            <h1 class="chart-title">Battery Temperature</h1>
            <canvas id="batteryChart"></canvas>
            <div id="batteryTable" class="table-container"></div>
          </div>
        </div>
        <div id="device-content" class="content-section">
          <h2>Request Device Data</h2>
          <div class="device-counter">
            <button id="decrease-device" onclick="changeDeviceCount(-1)">
              -
            </button>
            <span id="device-count">0</span>
            <button id="increase-device" onclick="changeDeviceCount(1)">
              +
            </button>
          </div>
          <div id="device-list"></div>
          <button id="request-device" onclick="requestDeviceData()">
            Request
          </button>
        </div>
      </main>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@latest"></script>
    <script src="../static/js/script.js"></script>
    <script>
      function showContent(sectionId) {
        // Hide all content sections
        document
          .querySelectorAll(".content-section")
          .forEach(function (section) {
            section.style.display = "none";
          });

        // Show the selected content section
        document.getElementById(sectionId).style.display = "block";
      }

      // Add event listeners to sidebar links
      document
        .getElementById("dashboard-link")
        .addEventListener("click", function () {
          showContent("dashboard-content");
        });

      document
        .getElementById("analytics-link")
        .addEventListener("click", function () {
          showContent("analytics-content");
        });

      document
        .getElementById("Request-device-link")
        .addEventListener("click", function () {
          showContent("device-content");
        });

      // Default content to show on page load
      showContent("dashboard-content");

      document.addEventListener("DOMContentLoaded", function () {
        const url =
          "http://127.0.0.1:5500/DashBoardMain-main/templates/jsonData.json";

        axios
          .get(url)
          .then((response) => {
            const data = response.data;
            processChartData(data);
          })
          .catch((error) => {
            console.error("Error fetching data: ", error);
          });

        function processChartData(data) {
          // Extracting data for charts
          const labels = []; // Use appropriate labels
          const voltageData = [];
          const currentData = [];
          const powerData = [];
          const brightnessData = [];
          const batteryData = [];

          // Assuming `data` contains an array of records
          data.forEach((record) => {
            labels.push(record.date); // Use the date field

            voltageData.push(record.PV);
            currentData.push(record.PC);
            powerData.push(record.PP);
            brightnessData.push(record.BrL);
            batteryData.push(record.BTem);
          });

          createChart(
            "voltageChart",
            "Voltage",
            labels,
            voltageData,
            "Voltage (V)",
            "voltageTable"
          );
          createChart(
            "currentChart",
            "Current",
            labels,
            currentData,
            "Current (A)",
            "currentTable"
          );
          createChart(
            "powerChart",
            "Power",
            labels,
            powerData,
            "Power (W)",
            "powerTable"
          );
          createChart(
            "brightnessChart",
            "Brightness Level",
            labels,
            brightnessData,
            "Brightness (%)",
            "brightnessTable"
          );
          createChart(
            "batteryChart",
            "Battery Temperature",
            labels,
            batteryData,
            "Temperature (°C)",
            "batteryTable"
          );
        }

        function createChart(
          chartId,
          title,
          labels,
          data,
          yAxisLabel,
          tableId
        ) {
          const ctx = document.getElementById(chartId).getContext("2d");
          new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: title,
                  data: data,
                  borderColor: "rgba(75, 192, 192, 1)",
                  borderWidth: 1,
                  fill: false,
                },
              ],
            },
            options: {
              responsive: true,
              title: {
                display: true,
                text: title,
              },
              scales: {
                x: {
                  type: "time",
                  time: {
                    unit: "day",
                  },
                  title: {
                    display: true,
                    text: "Date",
                  },
                },
                y: {
                  title: {
                    display: true,
                    text: yAxisLabel,
                  },
                },
              },
            },
          });

          createTable(tableId, labels, data, title);
        }

        function createTable(tableId, labels, data, title) {
          const tableContainer = document.getElementById(tableId);
          const table = document.createElement("table");
          const thead = document.createElement("thead");
          const tbody = document.createElement("tbody");

          // Create header row
          const headerRow = document.createElement("tr");
          const dateHeader = document.createElement("th");
          dateHeader.textContent = "Date";
          const dataHeader = document.createElement("th");
          dataHeader.textContent = title;
          headerRow.appendChild(dateHeader);
          headerRow.appendChild(dataHeader);
          thead.appendChild(headerRow);

          // Create data rows
          for (let i = 0; i < labels.length; i++) {
            const row = document.createElement("tr");
            const dateCell = document.createElement("td");
            dateCell.textContent = labels[i];
            const dataCell = document.createElement("td");
            dataCell.textContent = data[i];
            row.appendChild(dateCell);
            row.appendChild(dataCell);
            tbody.appendChild(row);
          }

          table.appendChild(thead);
          table.appendChild(tbody);
          tableContainer.appendChild(table);
        }
      });

      function changeDeviceCount(change) {
        const countElement = document.getElementById("device-count");
        let count = parseInt(countElement.textContent) + change;
        count = count < 0 ? 0 : count;
        countElement.textContent = count;
      }

      function requestDeviceData() {
        const count = document.getElementById("device-count").textContent;
        alert(`Requesting data for ${count} devices.`);
      }
    </script>
  </body>
</html>
